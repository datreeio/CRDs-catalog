{
  "type": "object",
  "description": "KongClusterPlugin is the Schema for the kongclusterplugins API.",
  "properties": {
    "apiVersion": {
      "type": "string",
      "description": "APIVersion defines the versioned schema of this representation of an object.\nServers should convert recognized schemas to the latest internal value, and\nmay reject unrecognized values.\nMore info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources"
    },
    "config": {
      "type": "object",
      "description": "Config contains the plugin configuration. It's a list of keys and values\nrequired to configure the plugin.\nPlease read the documentation of the plugin being configured to set values\nin here. For any plugin in Kong, anything that goes in the `config` JSON\nkey in the Admin API request, goes into this property.\nOnly one of `config` or `configFrom` may be used in a KongClusterPlugin, not both at once.",
      "x-kubernetes-preserve-unknown-fields": true
    },
    "configFrom": {
      "type": "object",
      "description": "ConfigFrom references a secret containing the plugin configuration.\nThis should be used when the plugin configuration contains sensitive information,\nsuch as AWS credentials in the Lambda plugin or the client secret in the OIDC plugin.\nOnly one of `config` or `configFrom` may be used in a KongClusterPlugin, not both at once.",
      "properties": {
        "secretKeyRef": {
          "type": "object",
          "description": "Specifies a name, a namespace, and a key of a secret to refer to.",
          "properties": {
            "key": {
              "type": "string",
              "description": "The key containing the value."
            },
            "name": {
              "type": "string",
              "description": "The secret containing the key."
            },
            "namespace": {
              "type": "string",
              "description": "The namespace containing the secret."
            }
          },
          "additionalProperties": false,
          "required": [
            "key",
            "name",
            "namespace"
          ]
        }
      },
      "additionalProperties": false,
      "required": [
        "secretKeyRef"
      ]
    },
    "configPatches": {
      "type": "array",
      "description": "ConfigPatches represents JSON patches to the configuration of the plugin.\nEach item means a JSON patch to add something in the configuration,\nwhere path is specified in `path` and value is in `valueFrom` referencing\na key in a secret.\nWhen Config is specified, patches will be applied to the configuration in Config.\nOtherwise, patches will be applied to an empty object.",
      "items": {
        "type": "object",
        "description": "NamespacedConfigPatch is a JSON patch to add values from secrets to KongClusterPlugin\nto the generated configuration of plugin in Kong.",
        "properties": {
          "path": {
            "type": "string",
            "description": "Path is the JSON path to add the patch."
          },
          "valueFrom": {
            "type": "object",
            "description": "ValueFrom is the reference to a key of a secret where the patched value comes from.",
            "properties": {
              "secretKeyRef": {
                "type": "object",
                "description": "Specifies a name, a namespace, and a key of a secret to refer to.",
                "properties": {
                  "key": {
                    "type": "string",
                    "description": "The key containing the value."
                  },
                  "name": {
                    "type": "string",
                    "description": "The secret containing the key."
                  },
                  "namespace": {
                    "type": "string",
                    "description": "The namespace containing the secret."
                  }
                },
                "additionalProperties": false,
                "required": [
                  "key",
                  "name",
                  "namespace"
                ]
              }
            },
            "additionalProperties": false,
            "required": [
              "secretKeyRef"
            ]
          }
        },
        "additionalProperties": false,
        "required": [
          "path",
          "valueFrom"
        ]
      }
    },
    "consumerRef": {
      "type": "string",
      "description": "ConsumerRef is a reference to a particular consumer."
    },
    "disabled": {
      "type": "boolean",
      "description": "Disabled set if the plugin is disabled or not."
    },
    "instance_name": {
      "type": "string",
      "description": "InstanceName is an optional custom name to identify an instance of the plugin. This is useful when running the\nsame plugin in multiple contexts, for example, on multiple services."
    },
    "kind": {
      "type": "string",
      "description": "Kind is a string value representing the REST resource this object represents.\nServers may infer this from the endpoint the client submits requests to.\nCannot be updated.\nIn CamelCase.\nMore info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds"
    },
    "metadata": {
      "type": "object"
    },
    "ordering": {
      "type": "object",
      "description": "Ordering overrides the normal plugin execution order. It's only available on Kong Enterprise.\n`<phase>` is a request processing phase (for example, `access` or `body_filter`) and\n`<plugin>` is the name of the plugin that will run before or after the KongPlugin.\nFor example, a KongPlugin with `plugin: rate-limiting` and `before.access: [\"key-auth\"]`\nwill create a rate limiting plugin that limits requests _before_ they are authenticated.",
      "properties": {
        "after": {
          "type": "object",
          "description": "PluginOrderingPhase indicates which plugins in a phase should affect the target plugin's order",
          "additionalProperties": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        },
        "before": {
          "type": "object",
          "description": "PluginOrderingPhase indicates which plugins in a phase should affect the target plugin's order",
          "additionalProperties": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        }
      },
      "additionalProperties": false
    },
    "plugin": {
      "type": "string",
      "description": "PluginName is the name of the plugin to which to apply the config."
    },
    "protocols": {
      "type": "array",
      "description": "Protocols configures plugin to run on requests received on specific\nprotocols.",
      "items": {
        "type": "string",
        "description": "KongProtocol is a valid Kong protocol.\nThis alias is necessary to deal with https://github.com/kubernetes-sigs/controller-tools/issues/342",
        "enum": [
          "http",
          "https",
          "grpc",
          "grpcs",
          "tcp",
          "tls",
          "udp"
        ]
      }
    },
    "run_on": {
      "type": "string",
      "description": "RunOn configures the plugin to run on the first or the second or both\nnodes in case of a service mesh deployment.",
      "enum": [
        "first",
        "second",
        "all"
      ]
    },
    "status": {
      "type": "object",
      "description": "Status represents the current status of the KongClusterPlugin resource.",
      "properties": {
        "conditions": {
          "type": "array",
          "description": "Conditions describe the current conditions of the KongClusterPluginStatus.\n\nKnown condition types are:\n\n* \"Programmed\"",
          "default": [
            {
              "lastTransitionTime": "1970-01-01T00:00:00Z",
              "message": "Waiting for controller",
              "reason": "Pending",
              "status": "Unknown",
              "type": "Programmed"
            }
          ],
          "items": {
            "type": "object",
            "description": "Condition contains details for one aspect of the current state of this API Resource.",
            "properties": {
              "lastTransitionTime": {
                "type": "string",
                "description": "lastTransitionTime is the last time the condition transitioned from one status to another.\nThis should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.",
                "format": "date-time"
              },
              "message": {
                "type": "string",
                "description": "message is a human readable message indicating details about the transition.\nThis may be an empty string.",
                "maxLength": 32768
              },
              "observedGeneration": {
                "type": "integer",
                "description": "observedGeneration represents the .metadata.generation that the condition was set based upon.\nFor instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date\nwith respect to the current state of the instance.",
                "format": "int64",
                "minimum": 0
              },
              "reason": {
                "type": "string",
                "description": "reason contains a programmatic identifier indicating the reason for the condition's last transition.\nProducers of specific condition types may define expected values and meanings for this field,\nand whether the values are considered a guaranteed API.\nThe value should be a CamelCase string.\nThis field may not be empty.",
                "minLength": 1,
                "maxLength": 1024,
                "pattern": "^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$"
              },
              "status": {
                "type": "string",
                "description": "status of the condition, one of True, False, Unknown.",
                "enum": [
                  "True",
                  "False",
                  "Unknown"
                ]
              },
              "type": {
                "type": "string",
                "description": "type of condition in CamelCase or in foo.example.com/CamelCase.",
                "maxLength": 316,
                "pattern": "^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$"
              }
            },
            "additionalProperties": false,
            "required": [
              "lastTransitionTime",
              "message",
              "reason",
              "status",
              "type"
            ]
          },
          "maxItems": 8,
          "x-kubernetes-list-type": "map",
          "x-kubernetes-list-map-keys": [
            "type"
          ]
        }
      },
      "additionalProperties": false
    }
  },
  "required": [
    "plugin"
  ],
  "x-kubernetes-validations": [
    {
      "message": "Using both config and configFrom fields is not allowed.",
      "rule": "!(has(self.config) && has(self.configFrom))"
    },
    {
      "message": "Using both configFrom and configPatches fields is not allowed.",
      "rule": "!(has(self.configFrom) && has(self.configPatches))"
    },
    {
      "message": "The plugin field is immutable",
      "rule": "self.plugin == oldSelf.plugin"
    }
  ]
}